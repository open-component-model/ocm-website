<!doctype html><html lang=en data-bs-theme=dark><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://ocm.software/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://ocm.software/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://ocm.software/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href="/main.fb30dce3aad4b401e19f42565914645c38f6cb26a8fb0014a655b24a0fa42ca84a2b1a29e4fc775c27c7c172ad16a48cd6a8ba0d2c95872e81f8dc00efa26aed.css" integrity="sha512-+zDc46rUtAHhn0JWWRRkXDj2yyao+wAUplWySg+kLKhKKxop5Px3XCfHwXKtFqSM1qi6DSyVhy6B+NwA76Jq7Q==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><base href=https://ocm.software/docs/tutorials/ocm-and-gitops/air-gapped-gitops-with-ocm-flux/><link rel=canonical href=https://ocm.software/docs/tutorials/ocm-and-gitops/air-gapped-gitops-with-ocm-flux/><title>Air-gapped GitOps with OCM & Flux | Open Component Model</title>
<meta name=description content="Air-gapped GitOps with OCM & Flux"><link rel=icon href=/favicon.ico sizes=32x32><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png sizes=180x180 type=image/png><link rel=icon href=/favicon-192x192.png sizes=192x192 type=image/png><link rel=icon href=/favicon-512x512.png sizes=512x512 type=image/png><link rel=manifest href=/manifest.webmanifest><meta property="og:url" content="https://ocm.software/docs/tutorials/ocm-and-gitops/air-gapped-gitops-with-ocm-flux/"><meta property="og:site_name" content="Open Component Model"><meta property="og:title" content="Air-gapped GitOps with OCM & Flux"><meta property="og:description" content="Air-gapped GitOps with OCM & Flux"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="og:image" content="https://ocm.software/logo-image.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ocm.software/logo-image.png"><meta name=twitter:title content="Air-gapped GitOps with OCM & Flux"><meta name=twitter:description content="Air-gapped GitOps with OCM & Flux"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://ocm.software/","name":"Open Component Model","position":1},{"@type":"ListItem","item":"https://ocm.software/docs/","name":"Docs","position":2},{"@type":"ListItem","item":"https://ocm.software/docs/tutorials/","name":"Tutorials","position":3},{"@type":"ListItem","item":"https://ocm.software/docs/tutorials/ocm-and-gitops/","name":"Ocm and Git Ops","position":4},{"@type":"ListItem","name":"Air Gapped Git Ops With Ocm \u0026 Flux","position":5}]}</script></head><body class="single section docs" data-bs-spy=scroll data-bs-target=#toc data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll=true tabindex=0><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-lg"><div class=container-fluid><a class="navbar-brand order-0" href=/ aria-label="Open Component Model"><img src=/images/logo-horizontal-white-text.png alt="Open Component Model Logo" class=header-logo>
</a><button type=button id=searchToggleMobile class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website">
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button class="btn btn-link d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavSection aria-controls=offcanvasNavSection aria-label="Open section navigation menu"><svg class="icon icon-tabler icon-tabler-dots-vertical" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 19m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 5m-1 0a1 1 0 102 0 1 1 0 10-2 0"/></svg></button><div class="offcanvas offcanvas-start d-lg-none" tabindex=-1 id=offcanvasNavSection aria-labelledby=offcanvasNavSectionLabel><div class=header-bar></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavSectionLabel>Docs</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close><svg class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class=offcanvas-body><aside class="doks-sidebar mt-n3"><nav id=doks-docs-nav aria-label="Tertiary navigation"><nav class="section-nav docs-links"><ul class=list-unstyled><li><details><summary>Overview</summary><ul class="list-unstyled list-nested"><li><a href=/docs/overview/about/>About the OCM Project</a></li><li><a href=/docs/overview/benefits-of-ocm/>Benefits of OCM</a></li><li><a href=/docs/overview/important-terms/>Important Terms</a></li><li><a href=/docs/overview/specification/>Specification</a></li></ul></details></li><li><details><summary>Getting Started</summary><ul class="list-unstyled list-nested"><li><a href=/docs/getting-started/prerequisites/>Prerequisites</a></li><li><a href=/docs/getting-started/installing-the-ocm-cli/>Installing the OCM CLI</a></li><li><a href=/docs/getting-started/create-a-component-version/>Create a Component Version</a></li><li><a href=/docs/getting-started/display-and-examine-component-versions/>Display and Examine Component Versions</a></li><li><a href=/docs/getting-started/sign-component-versions/>Sign Component Versions</a></li><li><a href=/docs/getting-started/transport-ocm-component-versions/>Transport OCM Component Versions</a></li><li><a href=/docs/getting-started/example-of-a-component-descriptor/>Example of a component descriptor</a></li></ul></details></li><li><details><summary>OCM Controllers</summary><ul class="list-unstyled list-nested"><li><a href=/docs/controller/installation/>Installation</a></li><li><a href=/docs/controller/architecture/>Architecture</a></li><li><a href=/docs/controller/ocm-controller-api-v1/>OCM Controller API v1</a></li><li><a href=/docs/controller/component-version/>Component Version</a></li></ul></details></li><li><details><summary>CLI Reference</summary><ul class="list-unstyled list-nested"><li><details><summary>add</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/add/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/add/references/>references</a></li><li><a href=/docs/cli-reference/add/resource-configuration/>resource-configuration</a></li><li><a href=/docs/cli-reference/add/resources/>resources</a></li><li><a href=/docs/cli-reference/add/routingslips/>routingslips</a></li><li><a href=/docs/cli-reference/add/source-configuration/>source-configuration</a></li><li><a href=/docs/cli-reference/add/sources/>sources</a></li></ul></details></li><li><details><summary>check</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/check/componentversions/>componentversions</a></li></ul></details></li><li><details><summary>clean</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/clean/cache/>cache</a></li></ul></details></li><li><details><summary>create</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/create/componentarchive/>componentarchive</a></li><li><a href=/docs/cli-reference/create/rsakeypair/>rsakeypair</a></li><li><a href=/docs/cli-reference/create/transportarchive/>transportarchive</a></li></ul></details></li><li><details><summary>describe</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/describe/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/describe/cache/>cache</a></li><li><a href=/docs/cli-reference/describe/package/>package</a></li><li><a href=/docs/cli-reference/describe/plugins/>plugins</a></li></ul></details></li><li><details><summary>download</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/download/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/download/cli/>cli</a></li><li><a href=/docs/cli-reference/download/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/download/resources/>resources</a></li></ul></details></li><li><details><summary>get</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/get/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/get/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/get/config/>config</a></li><li><a href=/docs/cli-reference/get/credentials/>credentials</a></li><li><a href=/docs/cli-reference/get/plugins/>plugins</a></li><li><a href=/docs/cli-reference/get/pubsub/>pubsub</a></li><li><a href=/docs/cli-reference/get/references/>references</a></li><li><a href=/docs/cli-reference/get/resources/>resources</a></li><li><a href=/docs/cli-reference/get/routingslips/>routingslips</a></li><li><a href=/docs/cli-reference/get/sources/>sources</a></li><li><a href=/docs/cli-reference/get/verified/>verified</a></li></ul></details></li><li><details><summary>help</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/help/attributes/>attributes</a></li><li><a href=/docs/cli-reference/help/configfile/>configfile</a></li><li><a href=/docs/cli-reference/help/credential-handling/>credential-handling</a></li><li><a href=/docs/cli-reference/help/logging/>logging</a></li><li><a href=/docs/cli-reference/help/oci-references/>oci-references</a></li><li><a href=/docs/cli-reference/help/ocm-accessmethods/>ocm-accessmethods</a></li><li><a href=/docs/cli-reference/help/ocm-downloadhandlers/>ocm-downloadhandlers</a></li><li><a href=/docs/cli-reference/help/ocm-labels/>ocm-labels</a></li><li><a href=/docs/cli-reference/help/ocm-pubsub/>ocm-pubsub</a></li><li><a href=/docs/cli-reference/help/ocm-references/>ocm-references</a></li><li><a href=/docs/cli-reference/help/ocm-uploadhandlers/>ocm-uploadhandlers</a></li><li><a href=/docs/cli-reference/help/toi-bootstrapping/>toi-bootstrapping</a></li></ul></details></li><li><details><summary>list</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/list/componentversions/>componentversions</a></li></ul></details></li><li><details><summary>set</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/set/pubsub/>pubsub</a></li></ul></details></li><li><details><summary>show</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/show/tags/>tags</a></li><li><a href=/docs/cli-reference/show/versions/>versions</a></li></ul></details></li><li><details><summary>sign</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/sign/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/sign/hash/>hash</a></li></ul></details></li><li><details><summary>transfer</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/transfer/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/transfer/commontransportarchive/>commontransportarchive</a></li><li><a href=/docs/cli-reference/transfer/componentarchive/>componentarchive</a></li><li><a href=/docs/cli-reference/transfer/componentversions/>componentversions</a></li></ul></details></li><li><details><summary>verify</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/verify/componentversions/>componentversions</a></li></ul></details></li></ul></details></li><li><details open><summary>Tutorials</summary><ul class="list-unstyled list-nested"><li><details open><summary>OCM and GitOps</summary><ul class="list-unstyled list-nested"><li><a href=/docs/tutorials/ocm-and-gitops/deploying-applications-with-ocm-gitops/>Deploying Applications with OCM & GitOps</a></li><li class=active><a aria-current=page href=/docs/tutorials/ocm-and-gitops/air-gapped-gitops-with-ocm-flux/>Air-gapped GitOps with OCM & Flux</a></li><li><a href=/docs/tutorials/ocm-and-gitops/gitops-driven-configuration-of-ocm-applications/>GitOps Driven Configuration of OCM Applications</a></li><li><a href=/docs/tutorials/ocm-and-gitops/secure-software-delivery-with-flux-and-ocm/>Secure software delivery with Flux and OCM</a></li></ul></details></li><li><a href=/docs/tutorials/best-practices/>Best Practices</a></li><li><a href=/docs/tutorials/build-deploy-applications-using-helm-charts-and-ocm/>Build & Deploy Applications using Helm Charts and OCM</a></li><li><a href=/docs/tutorials/structuring-software-products-with-ocm/>Structuring Software Products with OCM</a></li><li><a href=/docs/tutorials/input-and-access-types/>Input and Access Types</a></li><li><a href=/docs/tutorials/credentials-in-.ocmconfig-file/>Credentials in .ocmconfig file</a></li></ul></details></li></ul></nav></nav></aside></div></div><button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavMain aria-controls=offcanvasNavMain aria-label="Open main navigation menu"><svg class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><div class="offcanvas offcanvas-end h-auto" tabindex=-1 id=offcanvasNavMain aria-labelledby=offcanvasNavMainLabel><div class="header-bar d-lg-none"></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavMainLabel>Open Component Model</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close><svg class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class="offcanvas-body d-flex flex-column flex-lg-row justify-content-between"><ul class="navbar-nav flex-grow-1"><li class=nav-item><a class="nav-link active" href=https://ocm.software/docs/overview/about aria-current=true>Docs</a></li><li class=nav-item><a class=nav-link href=https://ocm.software/community/community>Community</a></li><li class=nav-item><a class=nav-link href=https://github.com/orgs/open-component-model/projects/10/views/5>Roadmap</a></li></ul><button type=button id=searchToggleDesktop class="btn btn-link nav-link p-2 d-none d-lg-block" aria-label="Search website"><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></button><ul id=socialMenu class="nav mx-auto flex-row order-lg-4"><li class=nav-item><a class="nav-link social-link" href=https://github.com/open-component-model><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg><small class="ms-2 visually-hidden">GitHub</small></a></li><li class=nav-item><a class="nav-link social-link" href=https://kubernetes.slack.com/archives/C05UWBE8R1D><svg role="img" width="22" height="22" viewBox="0 0 24 24" fill="#fff"><path d="M5.042 15.165a2.528 2.528.0 01-2.52 2.523A2.528 2.528.0 010 15.165a2.527 2.527.0 012.522-2.52h2.52v2.52zm1.271.0a2.527 2.527.0 012.521-2.52 2.527 2.527.0 012.521 2.52v6.313A2.528 2.528.0 018.834 24a2.528 2.528.0 01-2.521-2.522v-6.313zM8.834 5.042a2.528 2.528.0 01-2.521-2.52A2.528 2.528.0 018.834.0a2.528 2.528.0 012.521 2.522v2.52H8.834zm0 1.271a2.528 2.528.0 012.521 2.521 2.528 2.528.0 01-2.521 2.521H2.522A2.528 2.528.0 010 8.834a2.528 2.528.0 012.522-2.521h6.312zM18.956 8.834a2.528 2.528.0 012.522-2.521A2.528 2.528.0 0124 8.834a2.528 2.528.0 01-2.522 2.521h-2.522V8.834zm-1.268.0a2.528 2.528.0 01-2.523 2.521 2.527 2.527.0 01-2.52-2.521V2.522A2.527 2.527.0 0115.165.0a2.528 2.528.0 012.523 2.522v6.312zM15.165 18.956a2.528 2.528.0 012.523 2.522A2.528 2.528.0 0115.165 24a2.527 2.527.0 01-2.52-2.522v-2.522h2.52zm0-1.268a2.527 2.527.0 01-2.52-2.523 2.526 2.526.0 012.52-2.52h6.313A2.527 2.527.0 0124 15.165a2.528 2.528.0 01-2.522 2.523h-6.313z"/></svg><small class="ms-2 visually-hidden">Slack</small></a></li></ul></div></div></div></header></div><div class=modal id=searchModal tabindex=-1 aria-labelledby=searchModalLabel aria-hidden=true><div class="modal-dialog modal-dialog-scrollable modal-fullscreen-md-down"><div class=modal-content><div class=modal-header><h1 class="modal-title fs-5 visually-hidden" id=searchModalLabel>Search</h1><button type=button class="btn-close visually-hidden" data-bs-dismiss=modal aria-label=Close></button><div class="search-input flex-grow-1 d-none"><form id=search-form class=search-form action=# method=post accept-charset=UTF-8 role=search><label for=query class=visually-hidden>Search</label><div class=d-flex><input type=search id=query name=query class="search-text form-control form-control-lg" placeholder=Search aria-label=Search maxlength=128 autocomplete=off>
<button type=button class="btn btn-link text-decoration-none px-0 ms-3 d-md-none" data-bs-dismiss=modal aria-label=Close>Cancel</button></div></form></div></div><div class=modal-body><p class="search-loading status message d-none mt-3 text-center">Loading search index…</p><p class="search-no-recent message d-none mt-3 text-center">No recent searches</p><p class="search-no-results message d-none mt-3 text-center">No results for "<strong><span class=query-no-results>Query here</span></strong>"</p><div id=searchResults class=search-results></div><template><article class="search-result list-view"><div class="card my-3"><div class=card-body><header><h2 class="h5 title title-submitted mb-0"><a class="stretched-link text-decoration-none text-reset" href=#>Title here</a></h2><div class="submitted d-none"><time class=created-date>Date here</time></div></header><div class=content>Summary here</div></div></div></article></template></div><div class=modal-footer><ul class="list-inline me-auto d-none d-md-block"><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4m3 3-3-3 3-3"/></g></svg></kbd><span class=DocSearch-Label>to select</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8m3-3-3 3-3-3"/></g></svg></kbd><kbd class=me-2><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8m3 3-3-3-3 3"/></g></svg></kbd><span class=DocSearch-Label>to navigate</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993.0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016s1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5s-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864.0 1.6425 1.031 1.5443 2.2492h-2.956"/></g></svg></kbd><span class=DocSearch-Label>to close</span></li></ul><p class=d-md-none>Search by <a class=text-decoration-none href=https://github.com/nextapps-de/flexsearch>FlexSearch</a></p></div></div></div></div><div class="wrap container-fluid" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar docs-sidebar-offset d-none d-lg-block"><nav class="section-nav docs-links"><ul class=list-unstyled><li><details><summary>Overview</summary><ul class="list-unstyled list-nested"><li><a href=/docs/overview/about/>About the OCM Project</a></li><li><a href=/docs/overview/benefits-of-ocm/>Benefits of OCM</a></li><li><a href=/docs/overview/important-terms/>Important Terms</a></li><li><a href=/docs/overview/specification/>Specification</a></li></ul></details></li><li><details><summary>Getting Started</summary><ul class="list-unstyled list-nested"><li><a href=/docs/getting-started/prerequisites/>Prerequisites</a></li><li><a href=/docs/getting-started/installing-the-ocm-cli/>Installing the OCM CLI</a></li><li><a href=/docs/getting-started/create-a-component-version/>Create a Component Version</a></li><li><a href=/docs/getting-started/display-and-examine-component-versions/>Display and Examine Component Versions</a></li><li><a href=/docs/getting-started/sign-component-versions/>Sign Component Versions</a></li><li><a href=/docs/getting-started/transport-ocm-component-versions/>Transport OCM Component Versions</a></li><li><a href=/docs/getting-started/example-of-a-component-descriptor/>Example of a component descriptor</a></li></ul></details></li><li><details><summary>OCM Controllers</summary><ul class="list-unstyled list-nested"><li><a href=/docs/controller/installation/>Installation</a></li><li><a href=/docs/controller/architecture/>Architecture</a></li><li><a href=/docs/controller/ocm-controller-api-v1/>OCM Controller API v1</a></li><li><a href=/docs/controller/component-version/>Component Version</a></li></ul></details></li><li><details><summary>CLI Reference</summary><ul class="list-unstyled list-nested"><li><details><summary>add</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/add/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/add/references/>references</a></li><li><a href=/docs/cli-reference/add/resource-configuration/>resource-configuration</a></li><li><a href=/docs/cli-reference/add/resources/>resources</a></li><li><a href=/docs/cli-reference/add/routingslips/>routingslips</a></li><li><a href=/docs/cli-reference/add/source-configuration/>source-configuration</a></li><li><a href=/docs/cli-reference/add/sources/>sources</a></li></ul></details></li><li><details><summary>check</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/check/componentversions/>componentversions</a></li></ul></details></li><li><details><summary>clean</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/clean/cache/>cache</a></li></ul></details></li><li><details><summary>create</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/create/componentarchive/>componentarchive</a></li><li><a href=/docs/cli-reference/create/rsakeypair/>rsakeypair</a></li><li><a href=/docs/cli-reference/create/transportarchive/>transportarchive</a></li></ul></details></li><li><details><summary>describe</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/describe/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/describe/cache/>cache</a></li><li><a href=/docs/cli-reference/describe/package/>package</a></li><li><a href=/docs/cli-reference/describe/plugins/>plugins</a></li></ul></details></li><li><details><summary>download</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/download/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/download/cli/>cli</a></li><li><a href=/docs/cli-reference/download/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/download/resources/>resources</a></li></ul></details></li><li><details><summary>get</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/get/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/get/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/get/config/>config</a></li><li><a href=/docs/cli-reference/get/credentials/>credentials</a></li><li><a href=/docs/cli-reference/get/plugins/>plugins</a></li><li><a href=/docs/cli-reference/get/pubsub/>pubsub</a></li><li><a href=/docs/cli-reference/get/references/>references</a></li><li><a href=/docs/cli-reference/get/resources/>resources</a></li><li><a href=/docs/cli-reference/get/routingslips/>routingslips</a></li><li><a href=/docs/cli-reference/get/sources/>sources</a></li><li><a href=/docs/cli-reference/get/verified/>verified</a></li></ul></details></li><li><details><summary>help</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/help/attributes/>attributes</a></li><li><a href=/docs/cli-reference/help/configfile/>configfile</a></li><li><a href=/docs/cli-reference/help/credential-handling/>credential-handling</a></li><li><a href=/docs/cli-reference/help/logging/>logging</a></li><li><a href=/docs/cli-reference/help/oci-references/>oci-references</a></li><li><a href=/docs/cli-reference/help/ocm-accessmethods/>ocm-accessmethods</a></li><li><a href=/docs/cli-reference/help/ocm-downloadhandlers/>ocm-downloadhandlers</a></li><li><a href=/docs/cli-reference/help/ocm-labels/>ocm-labels</a></li><li><a href=/docs/cli-reference/help/ocm-pubsub/>ocm-pubsub</a></li><li><a href=/docs/cli-reference/help/ocm-references/>ocm-references</a></li><li><a href=/docs/cli-reference/help/ocm-uploadhandlers/>ocm-uploadhandlers</a></li><li><a href=/docs/cli-reference/help/toi-bootstrapping/>toi-bootstrapping</a></li></ul></details></li><li><details><summary>list</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/list/componentversions/>componentversions</a></li></ul></details></li><li><details><summary>set</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/set/pubsub/>pubsub</a></li></ul></details></li><li><details><summary>show</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/show/tags/>tags</a></li><li><a href=/docs/cli-reference/show/versions/>versions</a></li></ul></details></li><li><details><summary>sign</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/sign/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/sign/hash/>hash</a></li></ul></details></li><li><details><summary>transfer</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/transfer/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/transfer/commontransportarchive/>commontransportarchive</a></li><li><a href=/docs/cli-reference/transfer/componentarchive/>componentarchive</a></li><li><a href=/docs/cli-reference/transfer/componentversions/>componentversions</a></li></ul></details></li><li><details><summary>verify</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/verify/componentversions/>componentversions</a></li></ul></details></li></ul></details></li><li><details open><summary>Tutorials</summary><ul class="list-unstyled list-nested"><li><details open><summary>OCM and GitOps</summary><ul class="list-unstyled list-nested"><li><a href=/docs/tutorials/ocm-and-gitops/deploying-applications-with-ocm-gitops/>Deploying Applications with OCM & GitOps</a></li><li class=active><a aria-current=page href=/docs/tutorials/ocm-and-gitops/air-gapped-gitops-with-ocm-flux/>Air-gapped GitOps with OCM & Flux</a></li><li><a href=/docs/tutorials/ocm-and-gitops/gitops-driven-configuration-of-ocm-applications/>GitOps Driven Configuration of OCM Applications</a></li><li><a href=/docs/tutorials/ocm-and-gitops/secure-software-delivery-with-flux-and-ocm/>Secure software delivery with Flux and OCM</a></li></ul></details></li><li><a href=/docs/tutorials/best-practices/>Best Practices</a></li><li><a href=/docs/tutorials/build-deploy-applications-using-helm-charts-and-ocm/>Build & Deploy Applications using Helm Charts and OCM</a></li><li><a href=/docs/tutorials/structuring-software-products-with-ocm/>Structuring Software Products with OCM</a></li><li><a href=/docs/tutorials/input-and-access-types/>Input and Access Types</a></li><li><a href=/docs/tutorials/credentials-in-.ocmconfig-file/>Credentials in .ocmconfig file</a></li></ul></details></li></ul></nav></div><div class="col container-fw d-lg-flex flex-lg-row justify-content-center mx-auto"><nav class="docs-toc docs-toc-offset d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=toc><ul><li><a href=#introduction>Introduction</a></li><li><a href=#table-of-contents>Table of Contents</a></li><li><a href=#requirements>Requirements</a><ul><li><a href=#component-content>Component Content</a></li><li><a href=#component-transfer>Component Transfer</a></li><li><a href=#gitops--localization>GitOps & Localization</a></li><li><a href=#verification>Verification</a></li><li><a href=#to-be-continued>To Be Continued</a></li><li><a href=#conclusion>Conclusion</a></li></ul></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><h1>Air-gapped GitOps with OCM & Flux</h1><nav class="toc-mobile d-xl-none" aria-label="Quaternary navigation"><details><summary>On this page</summary><div class=page-links><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#table-of-contents>Table of Contents</a></li><li><a href=#requirements>Requirements</a><ul><li><a href=#component-content>Component Content</a></li><li><a href=#component-transfer>Component Transfer</a></li><li><a href=#gitops--localization>GitOps & Localization</a></li><li><a href=#verification>Verification</a></li><li><a href=#to-be-continued>To Be Continued</a></li><li><a href=#conclusion>Conclusion</a></li></ul></li></ul></nav></div></details></nav><h2 id=introduction>Introduction<a href=#introduction class=anchor aria-hidden=true>#</a></h2><p>In this guide, we will show you how the tools provided by OCM make it possible to automate your deployments to air-gapped environments.</p><p>Air-gapped can mean different things depending on the context. For this guide, we&rsquo;ll assume it means your deployment artifacts are stored in a private registry protected by the security controls at your organization. Your applications only have access to this private registry and little to no public internet access.</p><p>We&rsquo;ll take the same <code>podinfo</code> component that we deployed in the <a href=/docs/tutorials/ocm-and-gitops/deploying-applications-with-ocm-gitops/>Deploy Applications with OCM & GitOps</a> guide but this time we will use the OCM CLI to transfer the component to our own registry. The application will then be deployed from this &ldquo;private&rdquo; registry. This, of course, mimics a real-world air-gap scenario. In practice, there could be many layers of security between the two registries; however, the mechanics are ultimately the same.</p><h2 id=table-of-contents>Table of Contents<a href=#table-of-contents class=anchor aria-hidden=true>#</a></h2><ul><li><a href=#introduction>Introduction</a></li><li><a href=#table-of-contents>Table of Contents</a></li><li><a href=#requirements>Requirements</a><ul><li><a href=#component-content>Component Content</a></li><li><a href=#component-transfer>Component Transfer</a></li><li><a href=#gitops--localization>GitOps & Localization</a></li><li><a href=#verification>Verification</a></li><li><a href=#to-be-continued>To Be Continued</a></li><li><a href=#conclusion>Conclusion</a></li></ul></li></ul><h2 id=requirements>Requirements<a href=#requirements class=anchor aria-hidden=true>#</a></h2><ul><li><a href=https://github.com/open-component-model/ocm>OCM command line tool</a></li><li><a href=https://kubernetes.io/docs/reference/kubectl/>kubectl</a></li><li><a href=https://git-scm.com/downloads>git</a></li><li><a href=https://github.com/cli/cli>gh</a></li><li><a href=https://kind.sigs.k8s.io/docs/user/quick-start/#installation>kind</a></li><li><a href=https://fluxcd.io/flux/installation/#install-the-flux-cli>flux</a></li></ul><h3 id=component-content>Component Content<a href=#component-content class=anchor aria-hidden=true>#</a></h3><p>The <code>podinfo</code> component contains three resources:</p><ul><li>a container image for podinfo</li><li>a kubernetes deployment manifest for podinfo</li><li>a configuration file read by the ocm-controller</li></ul><p>We can list these resources using the <code>ocm</code> CLI:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ocm get resources ghcr.io/phoban01//phoban.io/podinfo -c v6.3.5
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME       VERSION IDENTITY TYPE      RELATION
</span></span><span class=line><span class=cl>config     6.3.5            PlainText <span class=nb>local</span>
</span></span><span class=line><span class=cl>deployment 6.3.5            Directory <span class=nb>local</span>
</span></span><span class=line><span class=cl>image      6.3.5            ociImage  external</span></span></code></pre></div></figure></div><p>If we examine the <code>config</code> file, we will see a section named <code>localization</code>:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ocm download resource ghcr.io/phoban01//phoban.io/podinfo -c v6.3.5 config -O -
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apiVersion: config.ocm.software/v1alpha1
</span></span><span class=line><span class=cl>kind: ConfigData
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: ocm-config
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>localization:
</span></span><span class=line><span class=cl>- name: image <span class=c1># rule name</span>
</span></span><span class=line><span class=cl>  file: deployment.yaml <span class=c1># target file for substitution</span>
</span></span><span class=line><span class=cl>  image: spec.template.spec.containers<span class=o>[</span>0<span class=o>]</span>.image <span class=c1># path in file to insert image name</span>
</span></span><span class=line><span class=cl>  resource: <span class=c1># ocm resource from which to resolve the image location</span>
</span></span><span class=line><span class=cl>    name: image</span></span></code></pre></div></figure></div><p>The <code>localization</code> section contains a list of rules that describe the substitutions the <code>ocm-controller</code> needs to perform to ensure that the <strong>Local</strong> copy of our image is deployed. OCM provides an identifier for each resource which can always be resolved to a specific storage location at which the resource can be accessed. This secret sauce makes it possible to automate air-gapped deployments using OCM.</p><p>We can examine the image resource to see precisely where the image can be accessed:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ocm get resources ghcr.io/phoban01//phoban.io/podinfo -c 6.3.5 image -owide
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME  VERSION IDENTITY TYPE     RELATION ACCESSTYPE  ACCESSSPEC
</span></span><span class=line><span class=cl>image 6.3.5            ociImage external ociArtifact <span class=o>{</span><span class=s2>&#34;imageReference&#34;</span>:<span class=s2>&#34;ghcr.io/stefanprodan/podinfo:6.3.5&#34;</span><span class=o>}</span></span></span></code></pre></div></figure></div><h3 id=component-transfer>Component Transfer<a href=#component-transfer class=anchor aria-hidden=true>#</a></h3><p>We can use the <code>ocm</code> CLI to transfer this public component into our &ldquo;private&rdquo; registry. Because we are simulating an air-gapped install, we instruct the <code>ocm</code> CLI to copy the resources along with the component metadata:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>AIR_GAPPED_REGISTRY</span><span class=o>=</span>ghcr.io/phoban01/air-gapped
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ocm transfer component --copy-resources ghcr.io/phoban01//phoban.io/podinfo <span class=nv>$AIR_GAPPED_REGISTRY</span></span></span></code></pre></div></figure></div><p>It will take few moments to complete the transfer. Once it is complete we can view the component in the air-gapped registry:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ocm get component ghcr.io/phoban01/air-gapped//phoban.io/podinfo
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>COMPONENT         VERSION PROVIDER
</span></span><span class=line><span class=cl>phoban.io/podinfo 6.2.3   phoban.io
</span></span><span class=line><span class=cl>phoban.io/podinfo 6.3.5   phoban.io</span></span></code></pre></div></figure></div><p>Let&rsquo;s examine the image resource on the component in our private registry:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ocm get resources <span class=nv>$AIR_GAPPED_REGISTRY</span>//phoban.io/podinfo -c 6.3.5 image -owide
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME  VERSION IDENTITY TYPE     RELATION ACCESSTYPE  ACCESSSPEC
</span></span><span class=line><span class=cl>image 6.3.5            ociImage external ociArtifact <span class=o>{</span><span class=s2>&#34;imageReference&#34;</span>:<span class=s2>&#34;ghcr.io/phoban01/air-gapped/stefanprodan/podinfo:6.3.5&#34;</span><span class=o>}</span></span></span></code></pre></div></figure></div><p>We can see that the image reference now points to an image stored in our air-gapped registry.</p><h3 id=gitops--localization>GitOps & Localization<a href=#gitops--localization class=anchor aria-hidden=true>#</a></h3><p>Now that our component has been successfully transferred, let&rsquo;s deploy it using GitOps.</p><p>We assume you have completed the <a href=/docs/tutorials/ocm-and-gitops/deploying-applications-with-ocm-gitops/>Deploy Applications with OCM & GitOps</a> guide and will use that repository as the starting point for our air-gapped deployment.</p><p>Because our air-gapped OCM repository is private, we need to provide credentials. This will enable the <code>ocm-controller</code> to retrieve components from the repository.</p><p>We can do this using a <code>ServiceAccount</code>. First, create an Kubernetes <code>Secret</code> to hold the credentials:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create secret docker-registry -n ocm-system ghcr-cred <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --docker-server<span class=o>=</span>ghcr.io <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --docker-username<span class=o>=</span><span class=nv>$GITHUB_USER</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --docker-password<span class=o>=</span><span class=nv>$GITHUB_TOKEN</span></span></span></code></pre></div></figure></div><p>Then, create the <code>ServiceAccount</code>:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>cat &gt; ./components/service_account.yaml &lt;&lt;EOF</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ServiceAccount</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>air-gapped-ops</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ocm-system</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>imagePullSecrets</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ghcr-cred</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>EOF</span></span></span></code></pre></div></figure></div><p>Next, let&rsquo;s modify the <code>ComponentVersion</code> manifest so that it points to our air-gapped OCM repository and references the <code>ServiceAccount</code>:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>delivery.ocm.software/v1alpha1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ComponentVersion</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>podinfo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ocm-system</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>1m0s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>component</span><span class=p>:</span><span class=w> </span><span class=l>phoban.io/podinfo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>semver</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&gt;=v6.3.5&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>repository</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=l>ghcr.io/phoban01/air-gapped</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>serviceAccountName</span><span class=p>:</span><span class=w> </span><span class=l>air-gapped-ops</span></span></span></code></pre></div></figure></div><p>Now we need to tell the <code>ocm-controller</code> to use the <strong>Localization</strong> rules we discussed earlier. To do this, we create a <code>Localization</code> Custom Resource:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>cat &gt; ./components/localization.yaml &gt;&gt;EOF</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>delivery.ocm.software/v1alpha1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Localization</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>podinfo-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ocm-system</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>5m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>sourceRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>podinfo-deployment</span><span class=w> </span><span class=c># this is the podinfo deployment manifest resource we created previously</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>configRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ComponentVersion</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>podinfo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resourceRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>config</span><span class=w> </span><span class=c># here we reference the resource containing localization rules</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>EOF</span></span></span></code></pre></div></figure></div><p>You can see that we have used the existing <code>Resource</code> as the source for the <code>Localization</code> and have provided the localization rules using the <code>spec.configRef</code> field. The <code>ocm-controller</code> enables us to freely chain resources together in order to perform a sequence of transformations upon an OCM resource.</p><p>Because the output we want to deploy is now generated by the <code>Localization</code> CR rather than the <code>Resource</code> CR, we need to update our <code>FluxDeployer</code>:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>delivery.ocm.software/v1alpha1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>FluxDeployer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>podinfo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ocm-system</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>sourceRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Localization</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>podinfo-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kustomizationTemplate</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>1m0s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>./</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>prune</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetNamespace</span><span class=p>:</span><span class=w> </span><span class=l>default</span></span></span></code></pre></div></figure></div><p>Let&rsquo;s commit, push, and reconcile these changes:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git add ./components
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>git commit -m <span class=s2>&#34;move to air-gapped repository&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>git push
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>flux reconcile <span class=nb>source</span> git flux-system</span></span></code></pre></div></figure></div><h3 id=verification>Verification<a href=#verification class=anchor aria-hidden=true>#</a></h3><p>Flux should now be reconciling the <strong>Localized</strong> manifest with image references pointing to our private OCM repository.</p><p>We can easily verify this using kubectl:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get deployment -n default podinfo -oyaml <span class=p>|</span> grep image <span class=p>|</span> xargs
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>image: ghcr.io/phoban01/air-gapped/stefanprodan/podinfo:6.3.5</span></span></code></pre></div></figure></div><h3 id=to-be-continued>To Be Continued<a href=#to-be-continued class=anchor aria-hidden=true>#</a></h3><p>If we look closer, however, we will see that our application has not successfully rolled out:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl get po -n default
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                       READY   STATUS             RESTARTS   AGE
</span></span><span class=line><span class=cl>podinfo-7b7d874bf8-xv75x   0/1     ImagePullBackOff   <span class=m>0</span>          1m4s</span></span></code></pre></div></figure></div><p>If we filter the events we can see that Kubernetes cannot pull the image owing to missing credentials:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get events --field-selector involvedObject.kind<span class=o>=</span>Pod
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>LAST SEEN   TYPE      REASON      OBJECT                         MESSAGE
</span></span><span class=line><span class=cl>7m31s       Normal    Scheduled   pod/podinfo-7b7d874bf8-xv75x   Successfully assigned default/podinfo-7b7d874bf8-xv75x to kind-control-plane
</span></span><span class=line><span class=cl>6m7s        Normal    Pulling     pod/podinfo-7b7d874bf8-xv75x   Pulling image <span class=s2>&#34;ghcr.io/phoban01/air-gapped/stefanprodan/podinfo:6.3.5&#34;</span>
</span></span><span class=line><span class=cl>6m6s        Warning   Failed      pod/podinfo-7b7d874bf8-xv75x   Failed to pull image <span class=s2>&#34;ghcr.io/phoban01/air-gapped/stefanprodan/podinfo:6.3.5&#34;</span>: rpc error: <span class=nv>code</span> <span class=o>=</span> Unknown <span class=nv>desc</span> <span class=o>=</span> failed to pull and unpack image <span class=s2>&#34;ghcr.io/phoban01/air-gapped/stefanprodan/podinfo:6.3.5&#34;</span>: failed to resolve reference <span class=s2>&#34;ghcr.io/phoban01/air-gapped/stefanprodan/podinfo:6.3.5&#34;</span>: failed to authorize: failed to fetch anonymous token: unexpected status: <span class=m>401</span> Unauthorized
</span></span><span class=line><span class=cl>6m6s        Warning   Failed      pod/podinfo-7b7d874bf8-xv75x   Error: ErrImagePull
</span></span><span class=line><span class=cl>2m31s       Normal    BackOff     pod/podinfo-7b7d874bf8-xv75x   Back-off pulling image <span class=s2>&#34;ghcr.io/phoban01/air-gapped/stefanprodan/podinfo:6.3.5&#34;</span>
</span></span><span class=line><span class=cl>5m44s       Warning   Failed      pod/podinfo-7b7d874bf8-xv75x   Error: ImagePullBackOff</span></span></code></pre></div></figure></div><p>Check out our <a href=/docs/tutorials/ocm-and-gitops/gitops-driven-configuration-of-ocm-applications>GitOps Driven Configuration of OCM Applications</a> guide to see how you can use the <code>ocm-controller</code> to configure your application at runtime and solve exactly this kind of problem!</p><h3 id=conclusion>Conclusion<a href=#conclusion class=anchor aria-hidden=true>#</a></h3><p>In this tutorial we have shown how we can automate the process of delivering software to air-gapped environments using the Open Component Model and Flux.</p><p>We have shown how the process of <strong>Localization</strong> is enabled via OCM and combined with GitOps delivers a seamless application deployment model suitable for any environment.</p><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="page-nav d-flex flex-column flex-sm-row"><div class="card w-100"><div class="card-body d-flex"><div class="d-flex flex-column justify-content-center"><svg class="icon icon-tabler icon-tabler-arrow-left" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M5 12l6 6"/><path d="M5 12l6-6"/></svg></div><div class="d-flex flex-column"><div class=text-body-secondary>Prev</div><a href=/docs/tutorials/ocm-and-gitops/deploying-applications-with-ocm-gitops/ class="stretched-link text-reset text-decoration-none">Deploying Applications with OCM & GitOps</a></div></div></div><div class=m-2></div><div class="card text-end w-100"><div class="card-body d-flex justify-content-end"><div class="d-flex flex-column"><div class=text-body-secondary>Next</div><a href=/docs/tutorials/ocm-and-gitops/gitops-driven-configuration-of-ocm-applications/ class="stretched-link text-reset text-decoration-none">GitOps Driven Configuration of OCM Applications</a></div><div class="d-flex flex-column justify-content-center"><svg class="icon icon-tabler icon-tabler-arrow-right" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M13 18l6-6"/><path d="M13 6l6 6"/></svg></div></div></div></div></main></div></div></div></div><footer class="footer text-muted"><div class=container-fluid><div class="text-center text-lg-end"><small><div style="width:100vw;position:relative;left:50%;margin-left:-50vw;padding:0 1rem;box-sizing:border-box"><div style=display:flex;justify-content:space-between;flex-wrap:wrap><small>Building this site is powered by <a href=https://www.netlify.com/ target=_blank rel=noopener>Netlify</a></small>
<small>© Copyright 2025,
<a href=https://www.sap.com/corporate/en/legal/copyright.html>SAP SE</a> and Open Component Model Contributors |
<a href=https://www.sap.com/about/legal/trademark.html>Trademark</a> |
<a href=https://www.sap.com/about/legal/privacy.html>Privacy Policy</a> |
<a href=https://www.sap.com/corporate/en/legal/terms-of-use.html>Terms of Use</a> |
<a href=https://www.sap.com/corporate/en/legal/impressum.html>Legal Disclosure</a></small></div></div></small></div></div></footer><script async src=/js/app.c17553444ec7c62f781ddbaa011948f6d85a1bab49420047d68a2b89852a8b36.js integrity="sha256-wXVTRE7Hxi94HduqARlI9thaG6tJQgBH1ooriYUqizY="></script><script async src=/js/flexsearch.7b25ae2da7ab3cc745d4f8536e3f914f92ea8b1afad96ab9249c160c35e0648c.js integrity="sha256-eyWuLaerPMdF1PhTbj+RT5Lqixr62Wq5JJwWDDXgZIw="></script><script async src=/js/search-modal.0415aa45353ab123a509f6ddc6861549ece898b90872fcf757cd2663041dac96.js integrity="sha256-BBWqRTU6sSOlCfbdxoYVSezomLkIcvz3V80mYwQdrJY="></script></body></html>