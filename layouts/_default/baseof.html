<!doctype html>
<html lang="{{ .Site.LanguageCode | default "en" }}" data-bs-theme="{{ site.Params.doks.colorMode | default "auto" }}">
{{ partial "head/head" . }}
{{ partial "head/body-class" . }}

<body class='{{ delimit (.Scratch.Get " class" | default (slice)) " " }}'{{ if eq site.Params.doks.scrollSpy true }} data-bs-spy="scroll" data-bs-target="#toc" data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll="true" tabindex="0" {{ end }}>
  {{ partial "header/custom-header" . }} <!-- Main content container -->
  {{ if .IsHome }}
  <div class="content">
    {{ block "main" . }}{{ end }}
  </div>
  {{ else }}
  <div class='wrap container-{{ site.Params.doks.containerBreakpoint | default "lg" }}' role="document">
    <div class="content">
      {{ block "main" . }}{{ end }}
    </div>
  </div>
  {{ end }}

  {{ block "sidebar-prefooter" . }}{{ end }}
  {{ block "sidebar-footer" . }}{{ end }}

  <!-- Footer partial (rendered only on Home/Landing page) -->
  {{ if .IsHome }}
  {{ partial "footer/footer" . }}
  {{ end }}

  {{ partial "footer/script-footer" . }}


  {{ if .Store.Get "hasMermaid" }}
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';

    function getMermaidTheme() {
      const htmlTheme = document.documentElement.getAttribute('data-bs-theme');
      if (htmlTheme === 'dark') return 'dark';
      if (htmlTheme === 'light') return 'default';
      // Auto mode - check system preference
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'default';
    }

    // Store original source before rendering
    document.querySelectorAll('.mermaid').forEach((el) => {
      el.setAttribute('data-mermaid-source', el.textContent);
    });

    mermaid.initialize({
      startOnLoad: true,
      theme: getMermaidTheme()
    });

    // Re-render on theme change
    const observer = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        if (mutation.attributeName === 'data-bs-theme') {
          document.querySelectorAll('.mermaid').forEach((el) => {
            const source = el.getAttribute('data-mermaid-source');
            if (source) {
              el.removeAttribute('data-processed');
              el.innerHTML = source;
            }
          });
          mermaid.initialize({ theme: getMermaidTheme() });
          mermaid.run();
        }
      });
    });
    observer.observe(document.documentElement, { attributes: true });
  </script>
  {{ end }}

  {{ if eq site.Params.doks.toTopButton true -}}
  {{ partial "footer/to-top" . }}
  {{ end }}
</body>

</html>
