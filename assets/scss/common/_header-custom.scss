/*
 * Custom header navigation with sticky positioning and glassmorphism effect.
 * Overrides Bootstrap navbar styles with !important where needed.
 *
 * Features:
 * - Sticky header with scroll effects
 * - Responsive navigation (mobile offcanvas, desktop inline)
 * - Version dropdown with custom tooltip
 * - Theme toggle and social icons
 * - Dark mode support
 */

/* ============================================
   CSS Custom Properties
   ============================================ */
:root {
    --nav-height: 56px;
    --nav-gap: clamp(16px, 2vw, 24px);
    --nav-link-size: 1rem;
    --fw-nav: 400;
    --fw-nav-hover: 400;
    --fw-nav-active: 500;
    --nav-border-scrolled: var(--lp-c-border);
}

.header {
    position: sticky;
    top: 0;
    z-index: 1000;
    width: 100%;
    height: var(--nav-height);
    transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;

    @include media-breakpoint-up(lg) {
        background-color: var(--lp-c-bg);

        /* Glassmorphism */
        @supports (backdrop-filter: blur(12px)) {
            background-color: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
        }
    }

    &.scrolled {
        border-bottom-color: var(--nav-border-scrolled);
        box-shadow: var(--shadow-md);
    }
}

.navbar {
    height: 100%;
    padding: 0 !important;

    .container-fluid {
        max-width: var(--container);
        height: 100%;
        display: flex;
        align-items: center;
        gap: var(--nav-gap);
        padding-inline: var(--nav-pad-x, 24px); // Add padding using var or fallback
    }
}

[data-bs-theme="dark"] {
    .navbar {
        background-color: transparent;
    }
}

[data-bs-theme="light"] {
    .navbar {
        background-color: var(--lp-c-bg);
    }
}

.navbar-brand {
    display: flex;
    align-items: center;
    padding: 0;
    margin: 0;
    font-size: 1rem;
    gap: 0.1rem; /* explicit tight gap between logo icon and brand text */

    img {
        // height attribute handles size, ensuring unconstrained width maintains aspect ratio
        display: block;
        margin-right: 0; /* rely on gap for spacing */
    }

    > span {
        margin-left: 0 !important; /* override utility margin to reduce gap next to logo */
        word-spacing: -0.35em;
    }
}

.navbar-nav {
    display: flex;
    flex-direction: column; // Column on mobile
    align-items: flex-start; // Align left on mobile
    gap: 1rem; // Spacing on mobile
    margin: 0;
    padding: 0;
    list-style: none;
    height: auto; // Auto height on mobile

    @include media-breakpoint-up(lg) {
        flex-direction: row; // Row on desktop
        align-items: center;
        gap: var(--nav-gap);
        height: 100%;
    }

    .nav-item {
        width: 100%; // Full width on mobile

        @include media-breakpoint-up(lg) {
            width: auto;
            height: 100%;
            display: flex;
            align-items: center;
        }
    }

    .nav-link {
        display: inline-flex;
        align-items: center;
        width: 100%; // Full width on mobile
        padding: 0.5rem 0; // Larger hit area on mobile
        font-size: var(--nav-link-size);
        font-weight: var(--fw-nav);
        color: var(--lp-c-text-1) !important;
        text-decoration: none;
        transition: color 0.15s ease;
        background: transparent;
        border: none;

        @include media-breakpoint-up(lg) {
            width: auto;
            height: 100%;
            padding: 0 4px;
        }

        &:hover,
        &:focus {
            color: var(--c-accent) !important;
            font-weight: var(--fw-nav-hover);
        }

        &.active,
        &[aria-current="page"] {
            color: var(--c-accent) !important;
            font-weight: var(--fw-nav-active);
        }
    }
}

/* Right aligned items */
.navbar-right {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-top: 1rem; // Spacing on mobile

    @include media-breakpoint-up(lg) {
        margin-left: auto;
        margin-top: 0;
        height: var(--nav-height); // Full height for container centering
    }

    // Standardize all utility buttons/links in the right section
    .btn-link,
    .nav-link,
    .header-github-pill,
    .mode-toggle {
        display: inline-flex !important;
        align-items: center !important;
        justify-content: center !important;
        height: 32px !important;
        margin: 0 !important;
        padding: 0 !important;
        line-height: 1 !important;
        vertical-align: middle !important;
    }
    
    // Dropdown container should not have height restriction
    .dropdown {
        display: inline-flex !important;
        align-items: center !important;
        justify-content: center !important;
        margin: 0 !important;
        padding: 0 !important;
        line-height: 1 !important;
        vertical-align: middle !important;
    }

    // Special handling for dropdown toggle buttons to ensure Bootstrap functionality
    .btn-dropdown {
        display: inline-flex !important;
        align-items: center !important;
        justify-content: center !important;
        height: 32px !important;
        margin: 0 !important;
        padding: 0 !important;
        line-height: 1 !important;
        vertical-align: middle !important;
        cursor: pointer !important;
    }

    /* Ensure consistent spacing between consecutive social icons (GitHub â†’ Slack),
       matching the 1rem spacing used by adjacent controls (e.g., search/toggle). */
    .header-github-pill + .header-github-pill {
        margin-left: 1rem !important;
    }

    /* Ensure consistent spacing between Slack and Versions dropdown */
    .header-github-pill + .dropdown {
        margin-left: 1rem !important;
    }

    .version-droplet {
        position: relative;
        padding: 4px 16px;
        background-color: #ffc107;
        color: #000;
        border-radius: 10px;
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        cursor: help;

        // Custom CSS Tooltip
        &::after {
            content: attr(data-tooltip);
            position: absolute;
            top: calc(100% + 14px); // Position below
            bottom: auto;
            right: 0; // Align to right edge (extends left)
            left: auto;
            width: 260px;
            padding: 12px;
            background-color: #1b1b1f;
            color: #fff;
            font-size: 13px;
            font-weight: 500;
            text-transform: none;
            line-height: 1.5;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
            opacity: 0;
            pointer-events: none;
            transition: all 0.2s cubic-bezier(0.165, 0.84, 0.44, 1);
            z-index: 1001;
            text-align: left;
            transform: translateY(-8px); // Start slightly up
        }

        // Tooltip Arrow
        &::before {
            content: "";
            position: absolute;
            top: calc(100% + 2px); // Tip of arrow just below element
            bottom: auto;
            right: 15px; // Align arrow with the droplet center (roughly)
            left: auto;
            border-width: 6px;
            border-style: solid;
            // Arrow pointing UP: Bottom border has color
            border-color: transparent transparent #1b1b1f transparent;
            opacity: 0;
            pointer-events: none;
            transition: all 0.2s cubic-bezier(0.165, 0.84, 0.44, 1);
            z-index: 1001;
            transform: translateY(-8px);
        }

        &:hover {

            &::after,
            &::before {
                opacity: 1;
                transform: translateY(0);
            }
        }
    }
}

/* GitHub Pill Style */
.navbar-right .header-github-pill {
    gap: 6px;
    color: var(--lp-c-text-1) !important;
    font-size: var(--nav-link-size);
    font-weight: var(--fw-nav);
    text-decoration: none !important;
    transition: color 0.15s ease, font-weight 0.15s ease;

    span {
        display: inline-flex;
        align-items: center;
    }

    &:hover {
        color: var(--c-accent) !important;
        font-weight: var(--fw-nav-hover);
    }

    .icon {
        width: 1.5rem;
        height: 1.5rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }
}

/* Version dropdown caret spacing */
.dropdown-caret {
    margin-left: 0.001rem;  // Minimal space between "Versions" text and dropdown icon
}

/* Theme Toggle */
.navbar-right .mode-toggle {
    width: 32px;
    color: var(--lp-c-text-1) !important;

    &:hover {
        color: var(--c-accent) !important;
    }
}

/* Button & Dropdown Reset */
.navbar-right .btn-link.nav-link,
.navbar-right .btn-dropdown,
.navbar-right .dropdown-toggle {
    font-size: var(--nav-link-size);
    font-weight: var(--fw-nav);
    color: var(--lp-c-text-1) !important;
    text-decoration: none !important;
    border: none !important;
    background: transparent !important;

    &:hover {
        color: var(--c-accent) !important;
        font-weight: var(--fw-nav-hover);
    }

    svg {
        stroke: currentColor;
    }

    &.me-3 {
        margin-right: 1rem !important; // Restore spacing for search button
    }
}

.dropdown-toggle::after {
    display: none; // Hide Bootstrap default caret if needed, though we use our own SVG
}

/* Dropdown Menu Styles */
.dropdown-menu {
    background-color: var(--lp-c-bg-elv) !important;
    border: 1px solid var(--lp-c-border) !important;
    padding: 8px 0;

    .dropdown-item {
        color: var(--lp-c-text-1) !important;
        font-size: 0.875rem;
        padding: 8px 16px;
        transition: background-color 0.2s ease, color 0.2s ease;

        &:hover,
        &:focus {
            background-color: var(--lp-c-bg-soft) !important;
            color: var(--c-accent) !important;
        }

        &.current,
        &[aria-current="true"] {
            color: var(--c-accent) !important;
            font-weight: 600;
        }

        .version-flag {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-left: 4px;
        }
    }
}

/* Mobile Toggle */
.navbar-toggler {
    border: none;
    background: transparent;
    padding: 0;
    color: var(--lp-c-text-2);
    display: flex;
    margin-left: auto;

    @include media-breakpoint-up(lg) {
        display: none;
    }
}

/* Offcanvas/Mobile Menu tweaks + Desktop Reset */
.offcanvas {
    background-color: var(--lp-c-bg);

    .offcanvas-header {
        border-bottom: 1px solid var(--lp-c-border);
    }

    .offcanvas-body {
        padding: 24px; // Spacing on mobile
        width: 100%; // Ensure body fills the offcanvas
    }

    /* DESKTOP RESET: Make offcanvas behave like normal navbar */
    @include media-breakpoint-up(lg) {
        position: static;
        z-index: auto;
        flex-grow: 1;
        width: 100% !important; // Force full width to fill container
        height: auto !important;
        visibility: visible !important;
        background-color: transparent !important;
        border: 0 !important;
        transform: none !important;
        transition: none;
        display: flex;
        align-items: center;

        .offcanvas-header {
            display: none;
        }

        .offcanvas-body {
            display: flex;
            align-items: center;
            flex-grow: 1;
            padding: 0;
            overflow: visible;
            width: 100%; // Ensure body fills the offcanvas
        }
    }
}
